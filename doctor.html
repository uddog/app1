<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSV to HTML Div Groups</title>
  <link rel="stylesheet" href="universal.css">
  <link rel="stylesheet" href="navbar.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <style>
    /* Style for the container */
.srch {
  display: flex;
  width: 100vw;
  margin-top: 12vh;
  justify-content: space-around;
}

/* Style for the select dropdown */
#doctorSelect {
  padding: 8px; /* Adjust padding as needed */
  border-radius: 5px; /* Adjust border radius as needed */
}

/* Style for the search input */
#searchBox {
  padding: 8px; /* Adjust padding as needed */
  border: 1px solid #ccc; /* Adjust border as needed */
  border-radius: 5px; /* Adjust border radius as needed */
}
.group {
margin-top: 10px;
margin-bottom: 20px;
border: 2px solid #ccc;
border-radius: 5px;
padding: 10px;
text-align: center;
}

.group h2 {
margin-top: 0;
font-size: 24px;
color: #333;
}

.profile {
box-shadow: rgba(0, 0, 0, 0.12) 0px 1px 3px, rgba(0, 0, 0, 0.24) 0px 1px 2px;
padding-top: 10px;
margin-top: 10px;
padding: 10px;
display: grid;
gap: 10px;
}
.profile:hover {
background-color: #9a9a9aac;
transition: 0.5s;
}
.profile img {
float: left;
grid-column: 1;
grid-row: 1 / span 3;
width: 100px; /* Adjust according to your preference */
height: 100px; /* Maintain aspect ratio */
}

.profile p {
font-family: "font4";
display: grid;
place-items: center;
}
.nam {
grid-column: 2 / span 3;
grid-row: 2 / span 1;
}
.inst {
grid-column: 2 / span 3;
grid-row: 3;
}
.det {
grid-row: 4;
grid-column: 1 / span 4;
}
.tim {
grid-row: 5;
grid-column: 1 / span 4;
}

    .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-left-color: #0a0a0a;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: none; /* Hide initially */
      }
  
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
  </style>
</head>
<body>

    <div class="spinner" id="spinner"></div>

    
    <!--NavBar Start-->
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-top" id="sidebarTop"></div>
        <a href="#" onclick="toggleSidebar()" class="close-btn">&times;</a>
        <a href="index.html" id="homeLink">Home</a>
        <a href="inbox.html">Inbox</a>
        <a href="profiles.html" id="profileBtn">Profile</a>
        <a href="settings.html">Settings</a>
        <a href="#" onclick="openLogoutPopup()" id="logoutBtn">Log Out</a>
    </div>
    <!-- Main content -->
    <header>
        <div>
            <div class="menu-icon" id="sidebarButton" onclick="toggleSidebar()">&#9776;</div>
        </div>
        <nav id="navbar">
        </nav>
    </header>

    <!-- Bio section -->
    <div class="bio-section" id="bioSection" style="display: none;">
    </div>

    <!-- Logout Popup -->
    <div class="overlay" id="overlay" onclick="closeLogoutPopup()"></div>
    <div class="popup" id="logoutPopup">
        <p>Are you sure you want to logout?</p>
        <a style="color: black;" href="index.html"><button onclick="logout()">Yes</button></a>  
        <button onclick="closeLogoutPopup()">No</button>
    </div>    
    <!--NavBar End-->


<div class="srch">
<div>
  <select id="doctorSelect">
    <option value="">All Doctors</option>
  </select>
</div>
<div>
  <input type="text" id="searchBox">
</div>
</div>

<div id="result"></div>

<script src="universal.js"></script>
<script src="navbar.js"></script>
<script>

        // Function to show loading spinner
        function showSpinner() {
            document.getElementById('spinner').style.display = 'block';
          }
      
          // Function to hide loading spinner
          function hideSpinner() {
            document.getElementById('spinner').style.display = 'none';
          }
      
  // Function to fetch CSV file and organize data into div groups
  function csvToDivGroups(url) {
    showSpinner(); // Show loading spinner before fetching data
    fetch(url)
      .then((response) => response.text())
      .then((data) => {
        hideSpinner(); // Hide loading spinner once data is fetched
        Papa.parse(data, {
          complete: function (results) {
            const rowData = results.data;

            // Create an object to hold grouped rows
            const groups = {};

            // Starting from index 1 to skip the header row
            for (let i = 1; i < rowData.length; i++) {
              const profileData = rowData[i];
              const name = profileData[3]; // Column D for name
              const doctor = profileData[5]; // Column F for doctor
              const institute = profileData[6]; // Column G for institute
              const details = profileData[11]; // Column L for details
              const time = profileData[12]; // Column M for time
              const imgSrc = profileData[13]; // Column N for image source
              const medicalField = profileData[4]; // Column E for medical field

              // Check if the profile belongs to "Medical" field
              if (medicalField === "Medical") {
                // Create a new group if it doesn't exist
                if (!groups[doctor]) {
                  groups[doctor] = [];
                }

                // Add the row to the respective group
                groups[doctor].push({
                  name: name,
                  institute: institute,
                  details: details,
                  time: time,
                  imgSrc: imgSrc, // Include image source in the profile data
                });
              }
            }

            // Populate select box with doctor names
            const selectBox = document.getElementById('doctorSelect');
            for (const doctor in groups) {
              if (groups.hasOwnProperty(doctor)) {
                const option = document.createElement('option');
                option.textContent = doctor;
                option.value = doctor;
                selectBox.appendChild(option);
              }
            }

            // Create divs for each group
            for (const doctor in groups) {
                if (groups.hasOwnProperty(doctor)) {
                const groupDiv = document.createElement("div");
                groupDiv.classList.add("group");
                groupDiv.setAttribute('data-doctor', doctor); // Add doctor name as data attribute
            
                // Add doctor's name as heading
                const heading = document.createElement("h2");
                heading.textContent = doctor;
                groupDiv.appendChild(heading);
            
                // Add profiles under the doctor
                groups[doctor].forEach((profileData) => {
                    const profileDiv = `
                    <div class="profile">
                        <img src="${profileData.imgSrc}" alt="Profile Image">
                        <p class="nam">নাম: ${profileData.name}</p>
                        <p class="inst">স্থান : ${profileData.institute}</p>
                        <p class="det">তথ্য: ${profileData.details}</p>
                        <p class="tim">সময়: ${profileData.time}</p>
                    </div>
                    `;
            
                    groupDiv.innerHTML += profileDiv;
                });
            
                document.getElementById("result").appendChild(groupDiv);
                }
            }
            
          },
          error: function (error) {
            hideSpinner(); // Hide loading spinner in case of error
            console.error("Error parsing CSV:", error);
          },
        });
      })
      .catch((error) => {
        hideSpinner(); // Hide loading spinner in case of error
        console.error("Error fetching CSV:", error);
      });
  }

  // Call the function with the URL of your CSV file
  const csvLink =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vQMec3rLMJvXIWdyVxO_ZVzKaJTrxrxqp4Wk1G2jjzEbRAr2x0df81w-6C3UrYpgNgilUTmz_ct4seU/pub?output=csv"; // Update with your CSV link
  window.onload = function () {
    csvToDivGroups(csvLink);
  };

  // Add event listener for select box change
document.getElementById('doctorSelect').addEventListener('change', function() {
    const selectedDoctor = this.value.toLowerCase(); // Get the selected doctor from the select box

    const groupDivs = document.querySelectorAll('.group');
    groupDivs.forEach(groupDiv => {
        const doctorName = groupDiv.getAttribute('data-doctor').toLowerCase(); // Get the doctor name associated with the group
        if (selectedDoctor === '' || doctorName === selectedDoctor) {
            groupDiv.style.display = 'block'; // Show the group if it matches the selected doctor or if "All Doctors" is selected
        } else {
            groupDiv.style.display = 'none'; // Hide the group if it doesn't match the selected doctor
        }
    });
});

  // Function to filter results based on selected doctor and search input
  function filterResults() {
    const searchKeyword = document.getElementById('searchBox').value.toLowerCase();

    const profileDivs = document.querySelectorAll('.profile');
    profileDivs.forEach(profileDiv => {
        const profileText = profileDiv.textContent.toLowerCase(); // Get all text content of the profile div
        const matchesSearch = profileText.includes(searchKeyword); // Check if the search keyword is found in the profile text

        if (matchesSearch) {
            profileDiv.style.display = 'grid'; // Show the profile if it matches the search keyword
            profileDiv.closest('.group').style.display = 'block'; // Show the group containing this profile
        } else {
            profileDiv.style.display = 'none'; // Hide the profile if it doesn't match the search keyword
        }
    });

    const groupDivs = document.querySelectorAll('.group');
    groupDivs.forEach(groupDiv => {
        const profilesInGroup = groupDiv.querySelectorAll('.profile');
        const visibleProfiles = Array.from(profilesInGroup).filter(profile => profile.style.display !== 'none');
        if (visibleProfiles.length === 0) {
            groupDiv.style.display = 'none'; // Hide the group if none of its profiles match the search keyword
        } else {
            groupDiv.style.display = 'grid'; // Show the group if at least one profile matches the search keyword
        }
    });
}


// Add event listeners for search box input
document.getElementById('searchBox').addEventListener('input', filterResults);
</script>
</body>
</html>
